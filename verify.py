import os
import sys
import hashlib
import shutil

script_path = os.path.dirname(os.path.realpath(sys.argv[0]))
root_path = os.path.join(script_path, 'exec_files')
verified_path = os.path.join(script_path, 'verified_files')

families = os.listdir(root_path)
total = 0
btotal = 0

for family in families:
    try:
        malwares = os.listdir(os.path.join(root_path, family))
        count = 0
        bcount = 0

        for malware in malwares:
            count += 1
            file_loc = os.path.join(root_path, family, malware)
            verified_loc = os.path.join(verified_path, family, malware)
            hash = malware
            calculated_hash = list()
            with open(file_loc, 'rb') as file:
                data = file.read()
                calculated_hash.append(hashlib.md5(data).hexdigest())
                calculated_hash.append(hashlib.sha1(data).hexdigest())

            if(hash in calculated_hash):
                bcount += 1
                if not os.path.exists(os.path.join(verified_path,family)):
                    os.makedirs(os.path.join(verified_path,family))
                    
                shutil.copy(file_loc, verified_loc)
    except:
        pass



    print(f"{family} \t {count} \t {bcount}")
    total += count
    btotal += bcount

print(f"Total: {total}")
print(f"B - Total: {btotal}")